
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Deal with the unforeseen - Octodroid</title>
	<meta name="author" content="Stefano Dacchille">

	
	<meta name="description" content="It&#8217;s quite common to invite users to rate an app on Google Play at some point, on one hand it&#8217;s good to know that your users are happy &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Octodroid" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">Octodroid</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:stefanodacchille.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/109727216394332902697?rel=author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/mod3rn0" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/stefanodacchille" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:stefanodacchille.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Deal With the Unforeseen</h2>
	<div class="entry-content"><p>It&#8217;s quite common to invite users to rate an app on Google Play at some point, on one hand it&#8217;s good to know that your users are happy and on the other it&#8217;s a good way to attract new users. It&#8217;s definitely not the only variable in the equation, but I can definitely say that user satisfaction is inversely proportional to the amount of crashes. But bugs are unfortunately something we have to expect as developers, even after testing our apps thoroughly. One thing we probably don&#8217;t want to do, is to ask a user to rate our app just after a crash since we can be reasonably sure that he&#8217;s not going to be too happy about it. How can we make sure that this doesn&#8217;t happen?</p>

<p>When an uncaught exception is thrown, the <a href="https://developer.android.com/reference/java/lang/Thread.UncaughtExceptionHandler.html#uncaughtException(java.lang.Thread,">uncaughtException</a> method of the default <a href="https://developer.android.com/reference/java/lang/Thread.UncaughtExceptionHandler.html">UncaughtExceptionHandler</a> for that Thread is called. Good news is, you can supply your own <a href="https://developer.android.com/reference/java/lang/Thread.UncaughtExceptionHandler.html">UncaughtExceptionHandler</a> using the <a href="https://developer.android.com/reference/java/lang/Thread.html#setDefaultUncaughtExceptionHandler(java.lang.Thread.UncaughtExceptionHandler)">setDefaultUncaughtExceptionHandler</a> setter (this is what <a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;ved=0CDYQFjAA&amp;url=http%3A%2F%2Fcode.google.com%2Fp%2Facra%2F&amp;ei=kAwBUezwL8_IsgbIvYH4Dg&amp;usg=AFQjCNF1L9fawVNYyKuqqIa7q22TBcL08w&amp;sig2=_FrQnihkSMcsqGUV5XXp1A&amp;bvm=bv.41524429,d.Yms">ACRA</a> and I suppose other libraries like <a href="https://www.crittercism.com/">Crittercism</a> or <a href="https://www.bugsense.com/">BugSense</a> do under the hood). Here is a little snippet of what we do in the <a href="https://play.google.com/store/apps/details?id=com.qype.radar">Qype app</a>:</p>

<pre><code>public class CustomUncaughtExceptionHandlerProxy implements Thread.UncaughtExceptionHandler {

    private static CustomUncaughtExceptionHandlerProxy proxy;

    private final boolean enabled;

    private Thread.UncaughtExceptionHandler customUncaughtExceptionHandler;

    private CustomUncaughtExceptionHandlerProxy(CustomApplication application) {
        enabled = !application.inDevMode();
        if (enabled) {
            // Save a reference to the current default handler.
            customUncaughtExceptionHandler = Thread.getDefaultUncaughtExceptionHandler();
            // Set our custom handler as the default one, so that it's first notified when something ugly happens.
            Thread.setDefaultUncaughtExceptionHandler(this);
        }
    }

    public static void initialize(CustomApplication application) {
        if (proxy == null) {
            proxy = new CustomUncaughtExceptionHandlerProxy(application);
        }
    }

    public static CustomUncaughtExceptionHandlerProxy getInstance() {
        return proxy;
    }

    @Override
    public void uncaughtException(Thread thread, Throwable ex) {
        if (enabled) {
            if (!preferences.rateAppDialogAlreadyShown()) {
                // reset count only if the 'rate app' dialog hasn't been already shown.
                preferences.resetShowRateAppDialogCountdown();
            }
            // Let the default uncaught exception handler do its job.
            customUncaughtExceptionHandler.uncaughtException(thread, ex);
        } else {
            Thread.getDefaultUncaughtExceptionHandler().uncaughtException(thread, ex);
        }
    }
}
</code></pre>

<p>This is a typical implementation of the <a href="http://en.wikipedia.org/wiki/Proxy_pattern">Proxy design pattern</a>, it&#8217;s pretty straightforward but here&#8217;s a little explanation of how it works. Let&#8217;s say you want to show a &#8220;Rate App&#8221; dialog after n times the app is opened by the user, you would use a counter and increment it each time the launcher Activity is created and it will show the dialog when the value of the counter is exactly n. But if the app crashes and the dialog is yet to be shown, you may want to reset the counter.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-24T16:00:00+01:00" pubdate data-updated="true">Jan 24<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/androiddev/'>androiddev</a>


</div>
	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_button_google_plusone" g:plusone:size="small"></a>
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Stefano Dacchille

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-40513317-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>